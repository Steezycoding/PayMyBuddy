<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <div th:fragment="content" class="container-fluid h-100 d-flex align-items-center justify-content-center">
        <form th:action="@{/money-transactions}" th:object="${transaction}" method="post" class="row align-items-center">
            <div class="col">
                <select th:field="*{receiverEmail}"
                        class="form-select"
                        id="contactSelect"
                        aria-label="Contact list"
                        onchange="updateReceiverUsername()" required>
                    <option value="" class="fst-italic" selected>Select a relation</option>
                    <option th:if="${contacts}"
                            th:each="contact : ${contacts}"
                            th:value="${contact.email}"
                            th:data-username="${contact.username}"
                            th:text="${contact.username}">
                    </option>
                </select>
                <input type="hidden" th:field="*{receiverUsername}" id="receiverUsername" name="receiverUsername" />
            </div>
            <div class="col-auto">
                <div class="form-floating">
                    <input type="text"
                           th:field="*{description}"
                           name="description"
                           class="form-control"
                           id="description"
                           placeholder="Enter a description for this transaction" />
                    <label for="description">Description</label>
                </div>
            </div>
            <div class="col-auto">
                <div class="input-group">
                    <input type="number"
                           th:field="*{amount}"
                           name="amount"
                           class="form-control"
                           id="amount"
                           placeholder="0"
                           aria-label="Amount of transaction" />
                    <span class="input-group-text">â‚¬</span>
                </div>
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-primary btn-lg">Pay</button>
            </div>
        </form>
        <script>
            function updateReceiverUsername() {
                const select = document.getElementById('contactSelect');
                const selectedOption = select.options[select.selectedIndex];
                const username = selectedOption.getAttribute('data-username');
                document.getElementById('receiverUsername').value = username || '';
            }
        </script>
    </div>
</body>
</html>